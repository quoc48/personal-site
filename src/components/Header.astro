---
const navLinks = [
  { href: '/work', label: 'Work' },
  { href: '/cv', label: 'My CV' },
  { href: '/contact', label: 'Contact' },
];

const currentPath = Astro.url.pathname;
---

<header class="w-full">
  <nav class="max-w-[1024px] mx-auto px-5 md:px-[50px] py-6 md:py-[50px] flex items-center justify-between">
    <!-- Logo -->
    <a href="/" class="font-lato font-bold text-2xl text-[#1E1E1E] hover:opacity-80 transition-opacity z-50">
      QP.
    </a>

    <!-- Desktop Menu -->
    <ul class="hidden md:flex items-center gap-8">
      {navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            class:list={[
              'font-lato text-xl text-[#1E1E1E] transition-all hover:font-medium',
              currentPath === link.href || currentPath === link.href + '/'
                ? 'font-medium'
                : 'font-light'
            ]}
          >
            {link.label}
          </a>
        </li>
      ))}
    </ul>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden relative w-10 h-10 z-50 flex items-center justify-center"
      aria-label="Toggle mobile menu"
      aria-expanded="false"
    >
      <div class="hamburger-wrapper relative w-6 h-5">
        <span class="hamburger-line absolute left-0 w-6 h-0.5 bg-[#1E1E1E] transition-all duration-300 top-0"></span>
        <span class="hamburger-line absolute left-0 w-6 h-0.5 bg-[#1E1E1E] transition-all duration-300 top-[9px]"></span>
        <span class="hamburger-line absolute left-0 w-6 h-0.5 bg-[#1E1E1E] transition-all duration-300 bottom-0"></span>
      </div>
    </button>

    <!-- Mobile Menu Overlay -->
    <div
      id="mobile-menu"
      class="fixed inset-0 bg-white z-40 flex flex-col items-center justify-center transform translate-x-full transition-transform duration-300 ease-in-out md:hidden"
    >
      <ul class="flex flex-col items-center gap-8">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={[
                'font-lato text-2xl text-[#1E1E1E] transition-all hover:font-medium',
                currentPath === link.href || currentPath === link.href + '/'
                  ? 'font-medium'
                  : 'font-light'
              ]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </nav>
</header>

<style>
  /* Hamburger to X animation */
  .menu-open .hamburger-line:nth-child(1) {
    top: 9px;
    transform: rotate(45deg);
  }
  .menu-open .hamburger-line:nth-child(2) {
    opacity: 0;
  }
  .menu-open .hamburger-line:nth-child(3) {
    bottom: 9px;
    transform: rotate(-45deg);
  }
</style>

<script>
  function initMobileMenu() {
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (!menuBtn || !mobileMenu) return;
    
    // Skip if already initialized
    if (menuBtn.dataset.initialized === 'true') return;
    menuBtn.dataset.initialized = 'true';

    const hamburgerWrapper = menuBtn.querySelector('.hamburger-wrapper');

    menuBtn.addEventListener('click', () => {
      const isOpen = mobileMenu.classList.contains('translate-x-0');
      
      if (isOpen) {
        // Close menu
        mobileMenu.classList.remove('translate-x-0');
        mobileMenu.classList.add('translate-x-full');
        hamburgerWrapper?.classList.remove('menu-open');
        menuBtn.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      } else {
        // Open menu
        mobileMenu.classList.remove('translate-x-full');
        mobileMenu.classList.add('translate-x-0');
        hamburgerWrapper?.classList.add('menu-open');
        menuBtn.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
      }
    });

    // Close menu when clicking a link
    mobileMenu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.remove('translate-x-0');
        mobileMenu.classList.add('translate-x-full');
        hamburgerWrapper?.classList.remove('menu-open');
        menuBtn.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      });
    });
  }

  // Initialize on various load events
  document.addEventListener('DOMContentLoaded', initMobileMenu);
  document.addEventListener('astro:page-load', initMobileMenu);
  
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(initMobileMenu, 0);
  }
</script>
